(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");
function randomString(length) {
    if (length === void 0) { length = 8; }
    if (!length) {
        length = Math.floor(Math.random() * chars.length);
    }
    var str = "";
    for (var i = 0; i < length; i++) {
        str += chars[Math.floor(Math.random() * chars.length)];
    }
    return str;
}
exports.randomString = randomString;
function extend(dst) {
    var srcs = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        srcs[_i - 1] = arguments[_i];
    }
    srcs.forEach(function (src) {
        for (var prop in src) {
            if (src.hasOwnProperty(prop)) {
                dst[prop] = src[prop];
            }
        }
    });
    return dst;
}
exports.extend = extend;
function clone(obj) {
    return JSON.parse(JSON.stringify(obj));
}
exports.clone = clone;
},{}],2:[function(require,module,exports){
var Utils = require("../common/utils");
var ViewModel = require("./view-model");
exports.defaultConfiguration = {
    rootNode: null,
    socketEventName: "board",
    throttlingInterval: 1000
};
function start(config) {
    var app = new App();
    config = Utils.extend({}, exports.defaultConfiguration, config);
    app.start(config);
}
exports.start = start;
var App = (function () {
    function App() {
        var _this = this;
        this.shadowServer = {};
        this.shadowClient = {};
        this.boardVM = new ViewModel.Board();
        this.onMessage = function (msg) {
            var board = msg.board;
            var patch = msg.patch;
            if (board) {
            }
            else if (patch) {
                _this.applyServerPatch(patch);
            }
        };
        this.onInterval = function () {
            var current = _this.boardVM.toPlain();
            var myChanges = rfc6902.createPatch(_this.shadowServer, current);
            if (myChanges.length) {
                _this.socket.emit(_this.socketEventName, { patch: myChanges });
            }
        };
    }
    App.prototype.applyServerPatch = function (serverChanges) {
        var current = this.boardVM.toPlain();
        var myChanges = rfc6902.createPatch(this.shadowClient, current);
        rfc6902.applyPatch(this.shadowServer, Utils.clone(serverChanges));
        rfc6902.applyPatch(current, serverChanges);
        rfc6902.applyPatch(current, myChanges);
        this.boardVM.update(current);
        this.shadowClient = this.boardVM.toPlain();
    };
    App.prototype.start = function (config) {
        this.socketEventName = config.socketEventName;
        this.boardVM.update(this.shadowServer);
        this.boardVM.applyBindings(config.rootNode);
        this.shadowClient = this.boardVM.toPlain();
        this.socket = io();
        this.socket.on(this.socketEventName, this.onMessage);
        setInterval(this.onInterval, config.throttlingInterval);
    };
    return App;
})();
},{"../common/utils":1,"./view-model":6}],3:[function(require,module,exports){
function register() {
    var _dragged;
    var _xFix;
    var _yFix;
    ko.bindingHandlers["drag"] = {
        init: function (element, valueAccessor, allBindingsAccessor, viewModel) {
            element.setAttribute("draggable", "true");
            element.addEventListener("dragstart", function (e) {
                e.dataTransfer.setData("data", "data");
                _xFix = e.clientX - viewModel.posX();
                _yFix = e.clientY - viewModel.posY();
                _dragged = viewModel;
            }, false);
        }
    };
    ko.bindingHandlers["drop"] = {
        init: function (element, valueAccessor, allBindingsAccessor, viewModel) {
            element.addEventListener("dragover", function (e) {
                e.preventDefault();
                return false;
            });
            element.addEventListener("drop", function (e) {
                _dragged.posX(e.clientX - _xFix);
                _dragged.posY(e.clientY - _yFix);
                return false;
            });
        }
    };
}
exports.register = register;
},{}],4:[function(require,module,exports){
function register() {
    ko.bindingHandlers["jeditable"] = {
        init: function (element, valueAccessor, allBindingsAccessor) {
            var options = allBindingsAccessor().jeditableOptions || {};
            if (!options.onblur) {
                options.onblur = "submit";
            }
            $(element).editable(function (value, params) {
                valueAccessor()(value);
                return value;
            }, options);
            ko.utils.domNodeDisposal.addDisposeCallback(element, function () {
                $(element).editable("destroy");
            });
        },
        update: function (element, valueAccessor) {
            var value = ko.utils.unwrapObservable(valueAccessor());
            $(element).html(value);
        }
    };
}
exports.register = register;
},{}],5:[function(require,module,exports){
var DragNDrop = require("./kobindings/dragndrop");
DragNDrop.register();
var JEditable = require("./kobindings/jeditable");
JEditable.register();
var App = require("./app");
App.start();
},{"./app":2,"./kobindings/dragndrop":3,"./kobindings/jeditable":4}],6:[function(require,module,exports){
var Utils = require("../common/utils");
var Note = (function () {
    function Note() {
        var _this = this;
        this.title = ko.observable();
        this.content = ko.observable();
        this.posX = ko.observable(0);
        this.posY = ko.observable(0);
        this.style = ko.computed(function () {
            var posX = _this.posX();
            var posY = _this.posY();
            return {
                top: posY ? posY + "px" : "0",
                left: posX ? posX + "px" : "0",
                display: posX != null && posY != null ? "block" : "none"
            };
        });
    }
    Note.prototype.update = function (plain) {
        this.title(plain.title);
        this.content(plain.content);
        this.posX(plain.posX);
        this.posY(plain.posY);
    };
    Note.prototype.toPlain = function () {
        var result = {};
        AddTruthyValue(result, "title", this.title());
        AddTruthyValue(result, "content", this.content());
        AddNumberValue(result, "posX", this.posX());
        AddNumberValue(result, "posY", this.posY());
        return result;
    };
    return Note;
})();
exports.Note = Note;
function AddTruthyValue(destination, key, value) {
    if (value) {
        destination[key] = value;
    }
}
function AddNumberValue(destination, key, value) {
    if (Object.prototype.toString.call(value) == "[object Number]") {
        destination[key] = value;
    }
}
var Board = (function () {
    function Board() {
        var _this = this;
        this.name = ko.observable();
        this.color = ko.observable();
        this.notes = ko.observableArray([]);
        this.notesById = {};
        this.newNote = function () {
            var note = _this.createNote();
            note.posX(0);
            note.posY(0);
            return note;
        };
    }
    Board.prototype.createNote = function (id) {
        if (id === void 0) { id = null; }
        id = id || Utils.randomString();
        var note = new Note();
        note.id = id;
        note.title("Title here");
        note.content("Content here");
        this.notesById[id] = note;
        this.notes.push(note);
        return note;
    };
    Board.prototype.deleteNote = function (id) {
        var note = this.notesById[id];
        delete this.notesById[id];
        this.notes.remove(note);
    };
    Board.prototype.update = function (plain) {
        this.name(plain.name);
        this.color(plain.color);
        var notes = plain.notes || {};
        for (var id in notes) {
            var noteVM = this.notesById[id];
            if (!noteVM) {
                noteVM = this.createNote(id);
            }
            noteVM.update(notes[id]);
        }
        for (var id in this.notesById) {
            if (!notes[id]) {
                this.deleteNote(id);
            }
        }
    };
    Board.prototype.toPlain = function () {
        var result = {};
        AddTruthyValue(result, "name", this.name());
        AddTruthyValue(result, "color", this.color());
        var noteVMs = this.notes();
        if (noteVMs.length) {
            var notes = {};
            for (var i in noteVMs) {
                var noteVM = noteVMs[i];
                notes[noteVM.id] = noteVM.toPlain();
            }
            result.notes = notes;
        }
        return result;
    };
    Board.prototype.applyBindings = function (rootNode) {
        ko.applyBindings(this, rootNode);
    };
    return Board;
})();
exports.Board = Board;
},{"../common/utils":1}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29tbW9uL3V0aWxzLnRzIiwic3JjL2tvY2xpZW50L2FwcC50cyIsInNyYy9rb2NsaWVudC9rb2JpbmRpbmdzL2RyYWduZHJvcC50cyIsInNyYy9rb2NsaWVudC9rb2JpbmRpbmdzL2plZGl0YWJsZS50cyIsInNyYy9rb2NsaWVudC9tYWluLnRzIiwic3JjL2tvY2xpZW50L3ZpZXctbW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxJQUFJLEtBQUssR0FBRywrREFBK0QsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDdEYsc0JBQTZCLE1BQWtCO0lBQWxCLHNCQUFrQixHQUFsQixVQUFrQjtJQUUzQyxFQUFFLENBQUMsQ0FBQyxDQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDWCxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDYixHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDOUIsR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQztBQUNmLENBQUM7QUFYZSxvQkFBWSxlQVczQixDQUFBO0FBRUQsZ0JBQTBCLEdBQU07SUFBRSxjQUFZO1NBQVosV0FBWSxDQUFaLHNCQUFZLENBQVosSUFBWTtRQUFaLDZCQUFZOztJQUM1QyxJ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QUN0QixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3RDLENBQUM7WUFDRCxNQUFNLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUN2QixDQUFDO1FBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQsNkJBQWEsR0FBYixVQUFjLFFBQWM7UUFDMUIsRUFBRSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUNILFlBQUM7QUFBRCxDQXhFQSxBQXdFQyxJQUFBO0FBeEVZLGFBQUssUUF3RWpCLENBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIGNoYXJzID0gXCIwMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYVFphYmNkZWZnaGlrbG1ub3BxcnN0dXZ3eHl6XCIuc3BsaXQoXCJcIik7XHJcbmV4cG9ydCBmdW5jdGlvbiByYW5kb21TdHJpbmcobGVuZ3RoOiBudW1iZXIgPSA4KSA6IHN0cmluZyB7XHJcbiAgICAvLyB3cml0ZSBhIGJldHRlciBnZW5lcmF0b3JcclxuICAgIGlmICghIGxlbmd0aCkge1xyXG4gICAgICAgIGxlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzLmxlbmd0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHN0ciA9IFwiXCI7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgc3RyICs9IGNoYXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzLmxlbmd0aCldO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0cjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGV4dGVuZDxUPihkc3Q6IFQsIC4uLnNyY3M6IFRbXSkgOiBUIHtcclxuICBzcmNzLmZvckVhY2goc3JjID0+IHtcclxuICAgIGZvciAodmFyIHByb3AgaW4gc3JjKSB7XHJcbiAgICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcclxuICAgICAgICAoPGFueT5kc3QpW3Byb3BdID0gKDxhbnk+c3JjKVtwcm9wXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHJldHVybiBkc3Q7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbG9uZTxUPihvYmo6IFQpIDogVCB7XHJcbiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7XHJcbn1cclxuIiwiaW1wb3J0IFV0aWxzID0gcmVxdWlyZShcIi4uL2NvbW1vbi91dGlsc1wiKTtcclxuaW1wb3J0IE1vZGVsID0gcmVxdWlyZShcIi4uL2NvbW1vbi9tb2RlbFwiKTtcclxuaW1wb3J0IFZpZXdNb2RlbCA9IHJlcXVpcmUoXCIuL3ZpZXctbW9kZWxcIik7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFwcENvbmZpZ3VyYXRpb24ge1xyXG4gIHJvb3ROb2RlPzogYW55O1xyXG4gIHNvY2tldEV2ZW50TmFtZT86IHN0cmluZztcclxuICB0aHJvdHRsaW5nSW50ZXJ2YWw/OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgZGVmYXVsdENvbmZpZ3VyYXRpb246IEFwcENvbmZpZ3VyYXRpb24gPSB7XHJcbiAgcm9vdE5vZGU6IG51bGwsXHJcbiAgc29ja2V0RXZlbnROYW1lOiBcImJvYXJkXCIsXHJcbiAgdGhyb3R0bGluZ0ludGVydmFsOiAxMDAwXHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3RhcnQoY29uZmlnPzogQXBwQ29uZmlndXJhdGlvbikge1xyXG4gIHZhciBhcHAgPSBuZXcgQXBwKCk7XHJcbiAgY29uZmlnID0gVXRpbHMuZXh0ZW5kKHsgfSwgZGVmYXVsdENvbmZpZ3VyYXRpb24sIGNvbmZpZyk7XHJcbiAgYXBwLnN0YXJ0KGNvbmZpZyk7XHJcbn1cclxuXHJcbmNsYXNzIEFwcCB7XHJcbiAgc2hhZG93U2VydmVyOiBNb2RlbC5Cb2FyZCA9IHsgfTtcclxuICBzaGFkb3dDbGllbnQ6IE1vZGVsLkJvYXJkID0geyB9O1xyXG4gIGJvYXJkVk0gPSBuZXcgVmlld01vZGVsLkJvYXJkKCk7XHJcbiAgc29ja2V0OiBTb2NrZXRJT0NsaWVudC5Tb2NrZXQ7XHJcbiAgc29ja2V0RXZlbnROYW1lOiBzdHJpbmc7XHJcblxyXG4gIGFwcGx5U2VydmVyUGF0Y2goc2VydmVyQ2hhbmdlczogTW9kZWwuUGF0Y2gpIHtcclxuICAgIHZhciBjdXJyZW50ID0gdGhpcy5ib2FyZFZNLnRvUGxhaW4oKTtcclxuICAgIHZhciBteUNoYW5nZXMgPSByZmM2OTAyLmNyZWF0ZVBhdGNoKHRoaXMuc2hhZG93Q2xpZW50LCBjdXJyZW50KTtcclxuICAgIC8vIEkgYW0gY2xvbm5pZyBwYXRjaCBiZWNhdXNlIHRoZSBjcmVhdGVkIG9iamVjdHMgaGFzIHRoZSBzYW1lIHJlZmVyZW5jZVxyXG4gICAgcmZjNjkwMi5hcHBseVBhdGNoKHRoaXMuc2hhZG93U2VydmVyLCBVdGlscy5jbG9uZShzZXJ2ZXJDaGFuZ2VzKSk7XHJcbiAgICByZmM2OTAyLmFwcGx5UGF0Y2goY3VycmVudCwgc2VydmVyQ2hhbmdlcyk7XHJcbiAgICByZmM2OTAyLmFwcGx5UGF0Y2goY3VycmVudCwgbXlDaGFuZ2VzKTtcclxuICAgIHRoaXMuYm9hcmRWTS51cGRhdGUoY3VycmVudCk7XHJcbiAgICB0aGlzLnNoYWRvd0NsaWVudCA9IHRoaXMuYm9hcmRWTS50b1BsYWluKCk7XHJcbiAgfVxyXG5cclxuICBvbk1lc3NhZ2UgPSAobXNnOiBNb2RlbC5NZXNzYWdlKSA9PiB7XHJcbiAgICB2YXIgYm9hcmQgPSAoPE1vZGVsLkJvYXJkTWVzc2FnZT5tc2cpLmJvYXJkO1xyXG4gICAgdmFyIHBhdGNoID0gKDxNb2RlbC5QYXRjaE1lc3NhZ2U+bXNnKS5wYXRjaDtcclxuICAgIGlmIChib2FyZCkge1xyXG4gICAgICAvLyBUT0RPOiByZWZyZXNoIGFsbCB0aGUgYm9hcmRcclxuICAgIH0gZWxzZSBpZiAocGF0Y2gpIHtcclxuICAgICAgdGhpcy5hcHBseVNlcnZlclBhdGNoKHBhdGNoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBvbkludGVydmFsPSAoKSA9PiB7XHJcbiAgICB2YXIgY3VycmVudCA9IHRoaXMuYm9hcmRWTS50b1BsYWluKCk7XHJcbiAgICB2YXIgbXlDaGFuZ2VzID0gcmZjNjkwMi5jcmVhdGVQYXRjaCh0aGlzLnNoYWRvd1NlcnZlciwgY3VycmVudCk7XHJcbiAgICBpZiAobXlDaGFuZ2VzLmxlbmd0aCkge1xyXG4gICAgICAvLyBUT0RPOiBjb25zaWRlciB0byBzZW5kIGl0IHVzaW5nIEhUVFAgaW4gcGxhY2Ugb2YgU29ja2V0XHJcbiAgICAgIHRoaXMuc29ja2V0LmVtaXQodGhpcy5zb2NrZXRFdmVudE5hbWUsIHsgcGF0Y2g6IG15Q2hhbmdlcyB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzdGFydChjb25maWc6IEFwcENvbmZpZ3VyYXRpb24pIHtcclxuICAgIHRoaXMuc29ja2V0RXZlbnROYW1lID0gY29uZmlnLnNvY2tldEV2ZW50TmFtZTtcclxuICAgIHRoaXMuYm9hcmRWTS51cGRhdGUodGhpcy5zaGFkb3dTZXJ2ZXIpO1xyXG4gICAgdGhpcy5ib2FyZFZNLmFwcGx5QmluZGluZ3MoY29uZmlnLnJvb3ROb2RlKTtcclxuICAgIHRoaXMuc2hhZG93Q2xpZW50ID0gdGhpcy5ib2FyZFZNLnRvUGxhaW4oKTtcclxuICAgIHRoaXMuc29ja2V0ID0gaW8oKTtcclxuXHJcbiAgICB0aGlzLnNvY2tldC5vbih0aGlzLnNvY2tldEV2ZW50TmFtZSwgdGhpcy5vbk1lc3NhZ2UpO1xyXG4gICAgc2V0SW50ZXJ2YWwodGhpcy5vbkludGVydmFsLCBjb25maWcudGhyb3R0bGluZ0ludGVydmFsKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyKCkge1xyXG4gIHZhciBfZHJhZ2dlZDogYW55O1xyXG4gIHZhciBfeEZpeDogbnVtYmVyO1xyXG4gIHZhciBfeUZpeDogbnVtYmVyO1xyXG5cclxuICBrby5iaW5kaW5nSGFuZGxlcnNbXCJkcmFnXCJdID0ge1xyXG4gICAgaW5pdDogKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCB2YWx1ZUFjY2Vzc29yOiAoKSA9PiBhbnksIGFsbEJpbmRpbmdzQWNjZXNzb3I6IGFueSwgdmlld01vZGVsOiBhbnkpID0+IHtcclxuICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgXCJ0cnVlXCIpO1xyXG4gICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnc3RhcnRcIiwgZSA9PiB7XHJcbiAgICAgICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YShcImRhdGFcIiwgXCJkYXRhXCIpOyAvLyByZXF1aXJlZCB0byBkcmFnXHJcbiAgICAgICAgX3hGaXggPSBlLmNsaWVudFggLSB2aWV3TW9kZWwucG9zWCgpO1xyXG4gICAgICAgIF95Rml4ID0gZS5jbGllbnRZIC0gdmlld01vZGVsLnBvc1koKTtcclxuICAgICAgICBfZHJhZ2dlZCA9IHZpZXdNb2RlbDtcclxuICAgICAgfSwgZmFsc2UpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGtvLmJpbmRpbmdIYW5kbGVyc1tcImRyb3BcIl0gPSB7XHJcbiAgICBpbml0OiAoZWxlbWVudDogSFRNTEVsZW1lbnQsIHZhbHVlQWNjZXNzb3I6ICgpID0+IGFueSwgYWxsQmluZGluZ3NBY2Nlc3NvcjogYW55LCB2aWV3TW9kZWw6IGFueSkgPT4ge1xyXG4gICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCBlID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIGFsbG93cyB1cyB0byBkcm9wXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgZSA9PiB7XHJcbiAgICAgICAgX2RyYWdnZWQucG9zWChlLmNsaWVudFggLSBfeEZpeCk7XHJcbiAgICAgICAgX2RyYWdnZWQucG9zWShlLmNsaWVudFkgLSBfeUZpeCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcbiIsImV4cG9ydCBmdW5jdGlvbiByZWdpc3RlcigpIHtcbiAga28uYmluZGluZ0hhbmRsZXJzW1wiamVkaXRhYmxlXCJdID0ge1xuICAgIGluaXQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlQWNjZXNzb3IsIGFsbEJpbmRpbmdzQWNjZXNzb3IpIHtcbiAgICAgIC8vIGdldCB0aGUgb3B0aW9ucyB0aGF0IHdlcmUgcGFzc2VkIGluXG4gICAgICB2YXIgb3B0aW9ucyA9IGFsbEJpbmRpbmdzQWNjZXNzb3IoKS5qZWRpdGFibGVPcHRpb25zIHx8IHt9O1xuXG4gICAgICAvLyBcInN1Ym1pdFwiIHNob3VsZCBiZSB0aGUgZGVmYXVsdCBvbmJsdXIgYWN0aW9uIGxpa2UgcmVndWxhciBrbyBjb250cm9sc1xuICAgICAgaWYgKCFvcHRpb25zLm9uYmx1cikge1xuICAgICAgICBvcHRpb25zLm9uYmx1ciA9IFwic3VibWl0XCI7XG4gICAgICB9XG5cbiAgICAgIC8vIHNldCB0aGUgdmFsdWUgb24gc3VibWl0IGFuZCBwYXNzIHRoZSBlZGl0YWJsZSB0aGUgb3B0aW9uc1xuICAgICAgJChlbGVtZW50KS5lZGl0YWJsZShmdW5jdGlvbih2YWx1ZSwgcGFyYW1zKSB7XG4gICAgICAgIHZhbHVlQWNjZXNzb3IoKSh2YWx1ZSk7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgICAvL2hhbmRsZSBkaXNwb3NhbCAoaWYgS08gcmVtb3ZlcyBieSB0aGUgdGVtcGxhdGUgYmluZGluZylcbiAgICAgIGtvLnV0aWxzLmRvbU5vZGVEaXNwb3NhbC5hZGREaXNwb3NlQ2FsbGJhY2soZWxlbWVudCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICQoZWxlbWVudCkuZWRpdGFibGUoXCJkZXN0cm95XCIpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vdXBkYXRlIHRoZSBjb250cm9sIHdoZW4gdGhlIHZpZXcgbW9kZWwgY2hhbmdlc1xuICAgIHVwZGF0ZTogZnVuY3Rpb24oZWxlbWVudCwgdmFsdWVBY2Nlc3Nvcikge1xuICAgICAgdmFyIHZhbHVlID0ga28udXRpbHMudW53cmFwT2JzZXJ2YWJsZSh2YWx1ZUFjY2Vzc29yKCkpO1xuICAgICAgJChlbGVtZW50KS5odG1sKHZhbHVlKTtcbiAgICB9XG4gIH07XG59XG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9qcXVlcnkvanF1ZXJ5LmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9rbm9ja291dC9rbm9ja291dC5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3Mvc29ja2V0LmlvLWNsaWVudC9zb2NrZXQuaW8tY2xpZW50LmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vY3VzdG9tLXR5cGluZ3MvZGVmYXVsdHMuZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9jdXN0b20tdHlwaW5ncy9qcXVlcnktamVkaXRhYmxlLmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vY3VzdG9tLXR5cGluZ3MvcmZjNjkwMi5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCBEcmFnTkRyb3AgPSByZXF1aXJlKFwiLi9rb2JpbmRpbmdzL2RyYWduZHJvcFwiKTtcclxuRHJhZ05Ecm9wLnJlZ2lzdGVyKCk7XHJcblxyXG5pbXBvcnQgSkVkaXRhYmxlID0gcmVxdWlyZShcIi4va29iaW5kaW5ncy9qZWRpdGFibGVcIik7XHJcbkpFZGl0YWJsZS5yZWdpc3RlcigpO1xyXG5cclxuaW1wb3J0IEFwcCA9IHJlcXVpcmUoXCIuL2FwcFwiKTtcclxuQXBwLnN0YXJ0KCk7XHJcbiIsImltcG9ydCBVdGlscyA9IHJlcXVpcmUoXCIuLi9jb21tb24vdXRpbHNcIik7XHJcbmltcG9ydCBNb2RlbCA9IHJlcXVpcmUoXCIuLi9jb21tb24vbW9kZWxcIik7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE5vdGVTdHlsZSB7XHJcbiAgdG9wOiBzdHJpbmc7XHJcbiAgbGVmdDogc3RyaW5nO1xyXG4gIGRpc3BsYXk6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE5vdGUge1xyXG4gIGlkOiBzdHJpbmc7XHJcblxyXG4gIHRpdGxlID0ga28ub2JzZXJ2YWJsZTxzdHJpbmc+KCk7XHJcbiAgY29udGVudCA9IGtvLm9ic2VydmFibGU8c3RyaW5nPigpO1xyXG4gIHBvc1ggPSBrby5vYnNlcnZhYmxlPG51bWJlcj4oMCk7XHJcbiAgcG9zWSA9IGtvLm9ic2VydmFibGU8bnVtYmVyPigwKTtcclxuXHJcbiAgc3R5bGUgPSBrby5jb21wdXRlZDxOb3RlU3R5bGU+KCgpID0+IHtcclxuICAgIHZhciBwb3NYID0gdGhpcy5wb3NYKCk7XHJcbiAgICB2YXIgcG9zWSA9IHRoaXMucG9zWSgpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG9wOiBwb3NZID8gYCR7cG9zWX1weGAgOiBcIjBcIixcclxuICAgICAgbGVmdDogcG9zWCA/IGAke3Bvc1h9cHhgIDogXCIwXCIsXHJcbiAgICAgIGRpc3BsYXk6IHBvc1ggIT0gbnVsbCAmJiBwb3NZICE9IG51bGwgID8gXCJibG9ja1wiIDogXCJub25lXCJcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG5cclxuICB1cGRhdGUocGxhaW46IE1vZGVsLk5vdGUpIHtcclxuICAgIHRoaXMudGl0bGUocGxhaW4udGl0bGUpO1xyXG4gICAgdGhpcy5jb250ZW50KHBsYWluLmNvbnRlbnQpO1xyXG4gICAgdGhpcy5wb3NYKHBsYWluLnBvc1gpO1xyXG4gICAgdGhpcy5wb3NZKHBsYWluLnBvc1kpO1xyXG5cclxuICB9XHJcblxyXG4gIHRvUGxhaW4oKTogTW9kZWwuTm90ZSB7XHJcbiAgICB2YXIgcmVzdWx0ID0geyB9O1xyXG4gICAgQWRkVHJ1dGh5VmFsdWUocmVzdWx0LCBcInRpdGxlXCIsIHRoaXMudGl0bGUoKSk7XHJcbiAgICBBZGRUcnV0aHlWYWx1ZShyZXN1bHQsIFwiY29udGVudFwiLCB0aGlzLmNvbnRlbnQoKSk7XHJcbiAgICBBZGROdW1iZXJWYWx1ZShyZXN1bHQsIFwicG9zWFwiLCB0aGlzLnBvc1goKSk7XHJcbiAgICBBZGROdW1iZXJWYWx1ZShyZXN1bHQsIFwicG9zWVwiLCB0aGlzLnBvc1koKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gQWRkVHJ1dGh5VmFsdWUoZGVzdGluYXRpb246IGFueSwga2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICBpZiAodmFsdWUpIHtcclxuICAgIGRlc3RpbmF0aW9uW2tleV0gPSB2YWx1ZTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEFkZE51bWJlclZhbHVlKGRlc3RpbmF0aW9uOiBhbnksIGtleTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSB7XHJcbiAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gXCJbb2JqZWN0IE51bWJlcl1cIikge1xyXG4gICAgZGVzdGluYXRpb25ba2V5XSA9IHZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEJvYXJkIHtcclxuICBuYW1lID0ga28ub2JzZXJ2YWJsZTxzdHJpbmc+KCk7XHJcbiAgY29sb3IgPSBrby5vYnNlcnZhYmxlPHN0cmluZz4oKTtcclxuICBub3RlcyA9IGtvLm9ic2VydmFibGVBcnJheTxOb3RlPihbXSk7XHJcblxyXG4gIC8vIFRPRE86IGNvbnNpZGVyIHRvIHJlbW92ZSB0aGlzIGluZGV4XHJcbiAgcHJpdmF0ZSBub3Rlc0J5SWQ6IERpY3Rpb25hcnk8Tm90ZT4gPSB7fTtcclxuXHJcbiAgbmV3Tm90ZSA9ICgpID0+IHtcclxuICAgIHZhciBub3RlID0gdGhpcy5jcmVhdGVOb3RlKCk7XHJcbiAgICBub3RlLnBvc1goMCk7XHJcbiAgICBub3RlLnBvc1koMCk7XHJcbiAgICByZXR1cm4gbm90ZTtcclxuICB9O1xyXG5cclxuICBjcmVhdGVOb3RlKGlkOiBzdHJpbmcgPSBudWxsKSA6IE5vdGUge1xyXG4gICAgaWQgPSBpZCB8fCBVdGlscy5yYW5kb21TdHJpbmcoKTtcclxuICAgIHZhciBub3RlID0gbmV3IE5vdGUoKTtcclxuICAgIG5vdGUuaWQgPSBpZDtcclxuICAgIG5vdGUudGl0bGUoIFwiVGl0bGUgaGVyZVwiICk7XHJcbiAgICBub3RlLmNvbnRlbnQoXCJDb250ZW50IGhlcmVcIik7XHJcbiAgICB0aGlzLm5vdGVzQnlJZFtpZF0gPSBub3RlO1xyXG4gICAgdGhpcy5ub3Rlcy5wdXNoKG5vdGUpO1xyXG4gICAgcmV0dXJuIG5vdGU7XHJcbiAgfVxyXG5cclxuICBkZWxldGVOb3RlKGlkOiBzdHJpbmcpIHtcclxuICAgIHZhciBub3RlID0gdGhpcy5ub3Rlc0J5SWRbaWRdO1xyXG4gICAgZGVsZXRlIHRoaXMubm90ZXNCeUlkW2lkXTtcclxuICAgIHRoaXMubm90ZXMucmVtb3ZlKG5vdGUpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlKHBsYWluOiBNb2RlbC5Cb2FyZCkge1xyXG4gICAgdGhpcy5uYW1lKHBsYWluLm5hbWUpO1xyXG4gICAgdGhpcy5jb2xvcihwbGFpbi5jb2xvcik7XHJcblxyXG4gICAgLy8gVE9ETzogdXBkYXRlIG9ic2VydmVibGUgYXJyYXkgb25seSBhIHRpbWVcclxuXHJcbiAgICB2YXIgbm90ZXMgPSBwbGFpbi5ub3RlcyB8fCB7fTtcclxuICAgIGZvciAodmFyIGlkIGluIG5vdGVzKSB7XHJcbiAgICAgIHZhciBub3RlVk0gPSB0aGlzLm5vdGVzQnlJZFtpZF07XHJcbiAgICAgIGlmICghbm90ZVZNKSB7XHJcbiAgICAgICAgbm90ZVZNID0gdGhpcy5jcmVhdGVOb3RlKGlkKTtcclxuICAgICAgfVxyXG4gICAgICBub3RlVk0udXBkYXRlKG5vdGVzW2lkXSk7XHJcbiAgICB9XHJcbiAgICBmb3IgKHZhciBpZCBpbiB0aGlzLm5vdGVzQnlJZCkge1xyXG4gICAgICBpZiAoIW5vdGVzW2lkXSkge1xyXG4gICAgICAgIHRoaXMuZGVsZXRlTm90ZShpZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHRvUGxhaW4oKTogTW9kZWwuQm9hcmQge1xyXG4gICAgdmFyIHJlc3VsdCA9IDxNb2RlbC5Cb2FyZD57IH07XHJcbiAgICBBZGRUcnV0aHlWYWx1ZShyZXN1bHQsIFwibmFtZVwiLCB0aGlzLm5hbWUoKSk7XHJcbiAgICBBZGRUcnV0aHlWYWx1ZShyZXN1bHQsIFwiY29sb3JcIiwgdGhpcy5jb2xvcigpKTtcclxuICAgIHZhciBub3RlVk1zID0gdGhpcy5ub3RlcygpO1xyXG4gICAgaWYgKG5vdGVWTXMubGVuZ3RoKSB7XHJcbiAgICAgIHZhciBub3RlcyA9IDxEaWN0aW9uYXJ5PE1vZGVsLk5vdGU+Pnt9O1xyXG4gICAgICBmb3IgKHZhciBpIGluIG5vdGVWTXMpIHtcclxuICAgICAgICB2YXIgbm90ZVZNID0gbm90ZVZNc1tpXTtcclxuICAgICAgICBub3Rlc1tub3RlVk0uaWRdID0gbm90ZVZNLnRvUGxhaW4oKTtcclxuICAgICAgfVxyXG4gICAgICByZXN1bHQubm90ZXMgPSBub3RlcztcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICBhcHBseUJpbmRpbmdzKHJvb3ROb2RlPzogYW55KSB7XHJcbiAgICBrby5hcHBseUJpbmRpbmdzKHRoaXMsIHJvb3ROb2RlKTtcclxuICB9XHJcbn1cclxuIl19
